# Тестовое задание ([C#-разработчик](https://devkg.com/ru/jobs/c-razrabotchik-strong-junior-middle-gu-kyzmat-17376?utm_source=telegram&utm_medium=channel&utm_campaign=transition))

## Описание

Необходимо разработать API с авторизацией пользователя и возможностью совершения платежа только после успешной авторизации.

API должно содержать три эндпоинта:

- `login` — принимает логин и пароль, при успешной аутентификации возвращает JWT-токен.
- `logout` — делает токен недействительным.
- `payment` — списывает 1.1 USD с баланса пользователя при каждом вызове (начальный баланс 8 USD), все платежи сохраняются в БД.

Готовый проект необходимо загрузить в репозиторий на GitHub.

## Требования

### Авторизация

- В случае неверного логина/пароля возвращать ошибку.
- Поддержка нескольких одновременных сессий пользователя.
- Хранение паролей в зашифрованном виде.
- Защита от брутфорса (подбора пароля).

### Платежи

- Защита от ошибочных списаний (изоляция транзакций).
- Корректная работа с округлением.
- Надежное хранение финансовых данных.

### Код

- Используемый стек технологий не принципиален.
- Простая и понятная реализация логики и базы данных.

## Используемые технологии

- **ASP.NET Core Minimal API**
- **JWT** (для аутентификации)
- **SQL Server** (хранение данных)
- **Dapper** (работа с БД)
- **Rate Limiting** (ограничение числа запросов для защиты от брутфорса)
- **Optimistic Concurrency** (оптимистическая блокировка для предотвращения гонки при обновлении баланса)
- **InMemoryCache** (хранение невалидных токенов)

## Подготовка к запуску

Перед запуском необходимо создать базу данных и выполнить SQL-скрипт `PaymentsDb.sql` для создания таблиц в **MS SQL Server**.

## Примеры запросов

### Регистрация пользователя

```http
POST https://localhost:44366/register
Content-Type: application/json

{
  "Username": "new-user-username",
  "Password": "new-user-password"
}
```

---

### Авторизация (получение токена)

```http
POST https://localhost:44366/login
Content-Type: application/json

{
  "Username": "registered-user-username",
  "Password": "registered-user-password"
}
```

---

### Выполнение платежа

```http
GET https://localhost:44366/api/execute-payment
Authorization: Bearer {{token}}
```

---

### Выход из системы

```http
POST https://localhost:{port}/api/logout
Authorization: Bearer {{token}}
```
